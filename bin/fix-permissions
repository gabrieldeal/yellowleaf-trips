#!/bin/sh

function fix_file_permissions() {
    # Otherwise, Backblaze won't backup the files:

    echo Fixing directory permissions in $@...
    find "$@" -type d -a \! -perm -a=r,a=x -exec chmod a+rx {} \;

    echo Fixing file permissions in $@...
    find "$@" -type f -a \! -perm -a=r -exec chmod a+r {} \;
}

for dir in "$@"
do
    if [ ! -d $dir ]
    then
	echo "Missing '$dir'" 1>&2
	exit 1
    fi

    fix_file_permissions $dir
done

exit 0
