#!/bin/sh

function fix_file_permissions() {
    # Otherwise, Backblaze won't backup the files:

    echo Fixing directory permissions...
    find "$@" -type d -a \! -perm -a=r,a=x -exec chmod a+rx {} \;

    echo Fixing file permissions...
    find "$@" -type f -a \! -perm -a=r -exec chmod a+r {} \;
}

skip_perm="$1"

dir=html
if [ ! -d $dir ]
then
	echo "Missing '$dir'" 1>&2
	exit 1
fi

if [ -z "$skip_perm" ]
then
    fix_file_permissions $dir bin lib dict data ~/pictures ~/Backups

    echo "Ready to rsync website ('n' to skip)?"
    read pauseme
fi

if [ -z "$pauseme" ]
then
    # rsync --delete --size-only  -e ssh -avz html/ gabrielx@addr43.addr.com:~/public_html/scramble

    # rsync -aviPh --progress --delete-after -e ssh --rsync-path=/home/gabrielx1/bin/rsync html/ gabrielx1@192.186.234.160:~/public_html/scramble
    rsync --delete --size-only  -e ssh -avz --rsync-path=/home/gabrielx1/bin/rsync html/ gabrielx1@192.186.234.160:~/public_html/scramble
fi

