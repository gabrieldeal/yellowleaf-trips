#!/usr/bin/env bash

function fix_file_permissions() {
    # Otherwise, Backblaze won't backup the files:

    echo Fixing directory permissions...
    find "$@" -type d -a \! -perm -a=r,a=x -exec chmod a+rx {} \;

    echo Fixing file permissions...
    find "$@" -type f -a \! -perm -a=r -exec chmod a+r {} \;
}

home_dir="/home/gabrielx"
output_dir="$home_dir/projects/yellowleaf-trips-data"
html_dir="$output_dir/html"

if [ ! -d $html_dir ]
then
	echo "Missing '$html_dir'" 1>&2
	exit 1
fi

# Do images first, then HTML.  This avoids broken images while in the middle of an update.
echo "Ready to rsync KML & images? (ctrl-c to abort)"
read pauseme
rsync \
      --size-only \
      -e ssh \
      -avz \
      --exclude '*.html' \
      --exclude '*.js' \
      --exclude '*.css' \
      --rsync-path=/home/gabrielx1/bin/rsync \
      "$html_dir/" \
      gabrielx1@192.186.234.160:~/public_html/scramble \
    | grep -E '^deleting|[^/]$|^$'

echo
echo "Ready to sync everything else? (ctrl-c to abort)"
read pauseme
rsync \
      --size-only \
      -e ssh \
      -avz \
      --rsync-path=/home/gabrielx1/bin/rsync \
      "$html_dir/" \
      gabrielx1@192.186.234.160:~/public_html/scramble \
    | grep -E '^deleting|[^/]$|^$'

