#!/usr/bin/env bash

function fix_file_permissions() {
    # Otherwise, Backblaze won't backup the files:

    echo Fixing directory permissions...
    find "$@" -type d -a \! -perm -a=r,a=x -exec chmod a+rx {} \;

    echo Fixing file permissions...
    find "$@" -type f -a \! -perm -a=r -exec chmod a+r {} \;
}

skip_perm="$1"

home_dir="/vagrant_gabriel_home/"
output_dir="$home_dir/projects/yellowleaf-trips"
html_dir="$output_dir/html"

if [ ! -d $html_dir ]
then
	echo "Missing '$html_dir'" 1>&2
	exit 1
fi

if [ -z "$skip_perm" ]
then
    fix_file_permissions "$output_dir" "$home_dir/pictures" "$home_dir/Backups"
fi

# Do images first, then HTML.  This avoids broken images while in the middle of an update.
echo "Ready to rsync images? (ctrl-c to abort)"
read pauseme
rsync --size-only  -e ssh -avz --rsync-path=/home/gabrielx1/bin/rsync "$html_dir/" gabrielx1@192.186.234.160:~/public_html/scramble --exclude '*.html'

echo "Ready to sync HTML? (ctrl-c to abort)"
read pauseme
rsync --delete --size-only  -e ssh -avz --rsync-path=/home/gabrielx1/bin/rsync "$html_dir/" gabrielx1@192.186.234.160:~/public_html/scramble


